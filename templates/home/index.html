{% load staticfiles %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="Citytours - Premium site template for city tours agencies, transfers and tickets.">
    <meta name="author" content="Ansonika">
    <title>{{config.title}}</title>

    <!-- Favicons-->
    <link rel="shortcut icon" href="{% static 'img/home/favicon.ico' %}" type="image/x-icon">
    <link rel="apple-touch-icon" type="image/x-icon" href="img/apple-touch-icon-57x57-precomposed.png">
    <link rel="apple-touch-icon" type="image/x-icon" sizes="72x72" href="{% static 'img/home/apple-touch-icon-72x72-precomposed.png' %}">
    <link rel="apple-touch-icon" type="image/x-icon" sizes="114x114" href="{% static 'img/home/apple-touch-icon-114x114-precomposed.png' %}">
    <link rel="apple-touch-icon" type="image/x-icon" sizes="144x144" href="{% static 'img/home/apple-touch-icon-144x144-precomposed.png' %}">

    <!-- CSS -->
    <link href="{% static 'css/home/base.css' %}" rel="stylesheet">

    {% include "base/style.html" %}

    <!-- Google web fonts -->
   <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
   <link href='http://fonts.googleapis.com/css?family=Gochi+Hand' rel='stylesheet' type='text/css'>
   <link href='http://fonts.googleapis.com/css?family=Lato:300,400' rel='stylesheet' type='text/css'>

    <style>
      html, body {height: 100%;}

      .btnLike{
        position:absolute;
        top:62%;
        left:70%;
        width: 30%;
        padding:4px 3px;
        border:none;
        box-shadow:none;
        border-radius: 20px 0px 0px 0px;
      }

      .btnLike i{
        font-size: 1.2em;
      }

      .btnLike:hover i{
        color: #0489B1;
      }

      .cursorPointer{
        cursor: pointer;
      }
    </style>

</head>
<body>

      <div id="preloader">
          <div class="sk-spinner sk-spinner-wave">
              <div class="sk-rect1"></div>
              <div class="sk-rect2"></div>
              <div class="sk-rect3"></div>
              <div class="sk-rect4"></div>
              <div class="sk-rect5"></div>
          </div>
      </div>
      <!-- End Preload -->

      <div class="layer"></div>
      <!-- Mobile menu overlay mask -->

      <!-- Header================================================== -->
      <header>
          <div id="top_line">
              <div class="container">
                  <div class="row">
                      <div class="col-md-6 col-sm-6 col-xs-6"></div>

                      <div class="col-md-6 col-sm-6 col-xs-6">
                          <ul id="top_links">
                              {% if user.is_authenticated %}
                                  <li><a href="{% url 'profile:home' user.username %}"><span class="icon-user"></span>{{ user.username }}</a></li>
                                  <li><a href="{% url 'logout' %}?next={% url 'home' %}"><span class="icon-logout"></span>Cerrar Sesíon</a></li>
                              {% else %}
                                  <li>
                                      <div class="dropdown dropdown-access">
                                          <a href="#" class="dropdown-toggle" data-toggle="dropdown" id="access_link">Iniciar Sesión</a>
                                          <div class="dropdown-menu">
                                              <div class="row">
                                                  <div class="col-md-6 col-sm-6 col-xs-6">
                                                      <a href="{% url 'social:begin' 'facebook' %}" class="bt_facebook">
                                                          <i class="icon-facebook"></i>Facebook </a>
                                                  </div>
                                                  <div class="col-md-6 col-sm-6 col-xs-6">
                                                      <a href="{% url 'social:begin' 'twitter' %}" class="bt_paypal">
                                                          <i class="icon-twitter"></i>Twitter </a>
                                                  </div>
                                              </div>
                                              <div class="login-or">
                                                  <hr class="hr-or">
                                                  <span class="span-or">ó</span>
                                              </div>
                                              <div>
                                              <form method="post" action="{% url 'login' %}">
                                                {% csrf_token %}
                                                  <div class="form-group">
                                                     <input type="text" class="form-control" id="inputUsernameEmail" name="username" placeholder="Usuario">
                                                  </div>
                                                  <div class="form-group">
                                                      <input type="password" class="form-control" id="inputPassword" name="password" placeholder="Contraseña">
                                                  </div>
                                                  <a id="forgot_pw" href="{% url 'password_reset' %}">Olvide mi contraseña</a>
                                                  <input type="submit" name="Sign_in" value="Entrar" id="Sign_in" class="button_drop">
                                                  <a href="{% url 'register' %}" class="button_drop outline">Registrar</a>
                                              </form>
                                              </div>
                                          </div>
                                      </div><!-- End Dropdown access -->
                                  </li>
                              {% endif %}
                          </ul>
                      </div>
                  </div><!-- End row -->
              </div><!-- End container-->
          </div><!-- End top line-->

          <div class="container">
              <div class="row">
                  <div class="col-md-3 col-sm-3 col-xs-3">
                      <div id="logo_home">
                      	<h1><a href="{% url 'home' %}" title="City tours travel template">{{config.title}}</a></h1>
                      </div>
                  </div>
                  <nav class="col-md-9 col-sm-9 col-xs-9">
                      <a class="cmn-toggle-switch cmn-toggle-switch__htx open_close" href="javascript:void(0);"><span>Menu mobile</span></a>
                      <div class="main-menu">
                          <div id="header_menu">
                              <img src="{{config.logo.url}}" width="100" height="60" alt="City tours" data-retina="true">
                          </div>
                          <a href="#" class="open_close" id="close_in"><i class="icon_set_1_icon-77"></i></a>
                          {% include "base/nav.html" %}
                      </div><!-- End main-menu -->
                  </nav>
              </div>
          </div><!-- container -->
      </header><!-- End Header -->

   <section class="header-video">
    <div id="hero_video">
  	<div class="intro_title" >
      	<h3 class="animated fadeInDown">Que esperas?</h3>
          <p class="animated fadeInDown">Crea tu propio evento en minutos</p>
          <a href="{% url 'events:new' %}" class="animated fadeInUp btn_1 blue">Crear un evento</a>
          <a  href="https://www.youtube.com/watch?v=Zz5cu72Gv5Y" class="video animated fadeInUp button_intro outline">Play video</a>
      </div>
   </div>
   	  <div id="search_bar_container" style="z-index:9999">
                  	<div class="container">
                              <div class="search_bar">
                              <span class="nav-facade-active" id="nav-search-in">
                              <span id="nav-search-in-content" style="">Todos</span>
                              <span class="nav-down-arrow nav-sprite"></span>
                              <select class="searchSelect" id="searchDropdownBox" name="tours_category" onchange="changeCategory()">
                                  <option value="0"  title="todos">Todos</option>
                                  {% for te in type_events %}
                                      <option value="{{te.id}}" title="{{te.tile}}">{{te.tile}}</option>
                                  {% endfor %}
                              </select>
                              </span>
                              <div class="nav-searchfield-outer">
                                  <input type="text" autocomplete="off" name="field-keywords" placeholder="Buscas algun evento?" id="twotabsearchtextbox">
                              </div>
                              <div class="nav-submit-button">
                                  <input type="submit" title="Cerca" class="nav-submit-input" value="Search">
                              </div>
                          </div><!-- End search bar-->
                      </div>
                  </div><!-- /search_bar-->
      			<img src=""  alt="Image" class="header-video--media" data-video-src="{{config.video_id}}"  data-teaser-source="{{config.video_id}}" data-provider="youtube" data-video-width="854" data-video-height="480">
  </section><!-- End Header video -->

    <div class="container-fluid full-height">
    	<div class="row row-height">
        	<div class="col-md-7 content-left">

        <div class="row">
                {% for d in data %}
                    <div class="col-md-6 col-sm-6" style="position:relative;">
					                  <div class="tour_container">
                            <div class="img_container">
                                <a href="{% url 'events:event_view_home' 'home' d.event.id %}">
                                <img src="{{ d.image.image.url }}" style="width:100%; height: 250px;" class="img-responsive" alt="Image">
                                <div class="short_info">
                                    <i class="{{d.event.type_event.icon}}"></i>{{ d.event.type_event.tile }}<span class="price"><sup>Desde $</sup>{{ d.ticket.price }}</span>
                                </div>
                                </a>
                            </div>
                            <div class="tour_title">
                                <h3><strong>{{ d.event.title }}</strong></h3>
                                <div class="rating">
                                    <button type="button"  class="btnLike" name="button"><i class="icon-thumbs-up-3"></i>Me gusta</button>
                                </div><!-- end rating -->
                                <div>
                                  <a onclick="onHtmlClick('Walking',{{ forloop.counter0 }})" class="cursorPointer" style="color: black;"><span style="color: #FA5858; font-size:1.5em;" class="icon-location-1"></span>Ver en el mapa</a>
                                </div>
                            </div>
                        </div><!-- End box tour -->
                    </div><!-- End col-md-6 -->
                {% endfor %}
        </div><!-- End row -->
            <hr>


            </div>

            <div class="col-md-5 map-right">
            	<div class="map" id="map"></div>
            </div>

        </div><!-- End row-->
    </div><!-- End container-fluid -->

    {% include "base/footer.html" %}


 <!-- Common scripts -->
<script src="{% static 'js/home/jquery-1.11.2.min.js' %}"></script>
<script src="{% static 'js/home/common_scripts_min.js' %}"></script>
<script src="{% static 'js/home/functions.js' %}"></script>
 <!-- Map -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD0ZfQL0Mxc4bnZnAtDk8bNL0-DZ18MkbM" type="text/javascript"></script>

<script>
    (function(A) {
	if (!Array.prototype.forEach)
		A.forEach = A.forEach || function(action, that) {
			for (var i = 0, l = this.length; i < l; i++)
				if (i in this)
					action.call(that, this[i], i, this);
			};

		})(Array.prototype);

        x = navigator.geolocation;
        x.getCurrentPosition(success,failure);

        var
                mapObject,
                markers = [],
                markersData = {
                    'Walking': [
                    {% for d in data %}
                        {
                            name: '{{ d.event.title }}',
                            location_latitude: '{{ d.event.location_address_latitude }}',
                            location_longitude: '{{ d.event.location_address_longitude }}',
                            map_image_url: '{{ d.image.image.url }}',
                            name_point: '{{ d.event.title }}',
                            description_point: '{{ d.event.description|slice:":100" }}',
                            get_directions_start_address: '{{ d.event.location_name }}',
                            phone: '+3934245255',
                            url_point: '{% url 'events:event_view_home' 'home' d.event.id %}'
                        },
                    {% endfor %}

                    ],
                };

        function success(position) {
                    var mapOptions = {
                        zoom: 13,
                        center: new google.maps.LatLng(position.coords.latitude, position.coords.longitude),
                        mapTypeId: google.maps.MapTypeId.ROADMAP,

                        mapTypeControl: false,
                        mapTypeControlOptions: {
                            style: google.maps.MapTypeControlStyle.DROPDOWN_MENU,
                            position: google.maps.ControlPosition.LEFT_CENTER
                        },
                        panControl: false,
                        panControlOptions: {
                            position: google.maps.ControlPosition.TOP_RIGHT
                        },
                        zoomControl: true,
                        zoomControlOptions: {
                            style: google.maps.ZoomControlStyle.LARGE,
                            position: google.maps.ControlPosition.RIGHT_BOTTOM
                        },
                         scrollwheel: false,
                        scaleControl: false,
                        scaleControlOptions: {
                            position: google.maps.ControlPosition.LEFT_CENTER
                        },
                        streetViewControl: true,
                        streetViewControlOptions: {
                            position: google.maps.ControlPosition.RIGHT_BOTTOM
                        },
                        styles: [
                                                     {
                            "featureType": "landscape",
                            "stylers": [
                                {
                                    "hue": "#FFBB00"
                                },
                                {
                                    "saturation": 43.400000000000006
                                },
                                {
                                    "lightness": 37.599999999999994
                                },
                                {
                                    "gamma": 1
                                }
                            ]
                        },
                        {
                            "featureType": "road.highway",
                            "stylers": [
                                {
                                    "hue": "#FFC200"
                                },
                                {
                                    "saturation": -61.8
                                },
                                {
                                    "lightness": 45.599999999999994
                                },
                                {
                                    "gamma": 1
                                }
                            ]
                        },
                        {
                            "featureType": "road.arterial",
                            "stylers": [
                                {
                                    "hue": "#FF0300"
                                },
                                {
                                    "saturation": -100
                                },
                                {
                                    "lightness": 51.19999999999999
                                },
                                {
                                    "gamma": 1
                                }
                            ]
                        },
                        {
                            "featureType": "road.local",
                            "stylers": [
                                {
                                    "hue": "#FF0300"
                                },
                                {
                                    "saturation": -100
                                },
                                {
                                    "lightness": 52
                                },
                                {
                                    "gamma": 1
                                }
                            ]
                        },
                        {
                            "featureType": "water",
                            "stylers": [
                                {
                                    "hue": "#0078FF"
                                },
                                {
                                    "saturation": -13.200000000000003
                                },
                                {
                                    "lightness": 2.4000000000000057
                                },
                                {
                                    "gamma": 1
                                }
                            ]
                        },
                        {
                            "featureType": "poi",
                            "stylers": [
                                {
                                    "hue": "#00FF6A"
                                },
                                {
                                    "saturation": -1.0989010989011234
                                },
                                {
                                    "lightness": 11.200000000000017
                                },
                                {
                                    "gamma": 1
                                }
                            ]
                        }
                        ]
                    };
                    var
                    marker;
                    mapObject = new google.maps.Map(document.getElementById('map'), mapOptions);
                    for (var key in markersData)
                        markersData[key].forEach(function (item) {
                            marker = new google.maps.Marker({
                                position: new google.maps.LatLng(item.location_latitude, item.location_longitude),
                                map: mapObject,
                                icon: '/static/img/home/pins/' + key + '.png',
                            });

                            if ('undefined' === typeof markers[key])
                                markers[key] = [];
                            markers[key].push(marker);
                            google.maps.event.addListener(marker, 'click', (function () {
              closeInfoBox();
              getInfoBox(item).open(mapObject, this);
              mapObject.setCenter(new google.maps.LatLng(item.location_latitude, item.location_longitude));
             }));


				});
        }

        function failure() {
			var mapOptions = {
				zoom: 13,
				center: new google.maps.LatLng(3.2602869, -76.5504358),
				mapTypeId: google.maps.MapTypeId.ROADMAP,

				mapTypeControl: false,
				mapTypeControlOptions: {
					style: google.maps.MapTypeControlStyle.DROPDOWN_MENU,
					position: google.maps.ControlPosition.LEFT_CENTER
				},
				panControl: false,
				panControlOptions: {
					position: google.maps.ControlPosition.TOP_RIGHT
				},
				zoomControl: true,
				zoomControlOptions: {
					style: google.maps.ZoomControlStyle.LARGE,
					position: google.maps.ControlPosition.RIGHT_BOTTOM
				},
				 scrollwheel: false,
				scaleControl: false,
				scaleControlOptions: {
					position: google.maps.ControlPosition.LEFT_CENTER
				},
				streetViewControl: true,
				streetViewControlOptions: {
					position: google.maps.ControlPosition.RIGHT_BOTTOM
				},
				styles: [
											 {
					"featureType": "landscape",
					"stylers": [
						{
							"hue": "#FFBB00"
						},
						{
							"saturation": 43.400000000000006
						},
						{
							"lightness": 37.599999999999994
						},
						{
							"gamma": 1
						}
					]
				},
				{
					"featureType": "road.highway",
					"stylers": [
						{
							"hue": "#FFC200"
						},
						{
							"saturation": -61.8
						},
						{
							"lightness": 45.599999999999994
						},
						{
							"gamma": 1
						}
					]
				},
				{
					"featureType": "road.arterial",
					"stylers": [
						{
							"hue": "#FF0300"
						},
						{
							"saturation": -100
						},
						{
							"lightness": 51.19999999999999
						},
						{
							"gamma": 1
						}
					]
				},
				{
					"featureType": "road.local",
					"stylers": [
						{
							"hue": "#FF0300"
						},
						{
							"saturation": -100
						},
						{
							"lightness": 52
						},
						{
							"gamma": 1
						}
					]
				},
				{
					"featureType": "water",
					"stylers": [
						{
							"hue": "#0078FF"
						},
						{
							"saturation": -13.200000000000003
						},
						{
							"lightness": 2.4000000000000057
						},
						{
							"gamma": 1
						}
					]
				},
				{
					"featureType": "poi",
					"stylers": [
						{
							"hue": "#00FF6A"
						},
						{
							"saturation": -1.0989010989011234
						},
						{
							"lightness": 11.200000000000017
						},
						{
							"gamma": 1
						}
					]
				}
				]
			};
			var
			marker;
			mapObject = new google.maps.Map(document.getElementById('map'), mapOptions);
			for (var key in markersData)
				markersData[key].forEach(function (item) {
					marker = new google.maps.Marker({
						position: new google.maps.LatLng(item.location_latitude, item.location_longitude),
						map: mapObject,
						icon: '/static/img/home/pins/' + key + '.png',
					});

					if ('undefined' === typeof markers[key])
						markers[key] = [];
					markers[key].push(marker);
					google.maps.event.addListener(marker, 'click', (function () {
      closeInfoBox();
      getInfoBox(item).open(mapObject, this);
      mapObject.setCenter(new google.maps.LatLng(item.location_latitude, item.location_longitude));
     }));


				});
        }

		function hideAllMarkers () {
			for (var key in markers)
				markers[key].forEach(function (marker) {
					marker.setMap(null);
				});
		};

		function toggleMarkers (category) {
			hideAllMarkers();
			closeInfoBox();

			if ('undefined' === typeof markers[category])
				return false;
			markers[category].forEach(function (marker) {
				marker.setMap(mapObject);
				marker.setAnimation(google.maps.Animation.DROP);

			});
		};

		function closeInfoBox() {
			$('div.infoBox').remove();
		};

		function getInfoBox(item) {
			return new InfoBox({
				content:
				'<div class="marker_info_2">' +
				'<img src="' + item.map_image_url + '" width="240" height="140"  alt="Image"/>' +
				'<h3>'+ item.name_point +'</h3>' +
				'<span>'+ item.description_point +'</span>' +
				'<div class="marker_tools">' +
				'<form action="http://maps.google.com/maps" method="get" target="_blank" style="display:inline-block""><input name="saddr" value="'+ item.get_directions_start_address +'" type="hidden"><input type="hidden" name="daddr" value="'+ item.location_latitude +',' +item.location_longitude +'"><button type="submit" value="Get directions" class="btn_infobox_get_directions">Directions</button></form>' +
					'<a href="tel://'+ item.phone +'" class="btn_infobox_phone">'+ item.phone +'</a>' +
					'</div>' +
					'<a href="'+ item.url_point + '" class="btn_infobox">Pagina del evento</a>' +
				'</div>',
				disableAutoPan: false,
				maxWidth: 0,
				pixelOffset: new google.maps.Size(10, 125),
				closeBoxMargin: '5px -20px 2px 2px',
				closeBoxURL: "http://www.google.com/intl/en_us/mapfiles/close.gif",
				isHidden: false,
				alignBottom: true,
				pane: 'floatPane',
				enableEventPropagation: true
			});
		};

		function onHtmlClick(location_type, key){
            google.maps.event.trigger(markers[location_type][key], "click");
}
</script>

<script src="{% static 'js/home/infobox.js' %}"></script>

<script src="{% static 'js/home/modernizr.js' %}"></script>
<script src="{% static 'js/home/video_header.js' %}"></script>
<script>
$(document).ready(function() {

   HeaderVideo.init({
      container: $('.header-video'),
      header: $('.header-video--media'),
      videoTrigger: $("#video-trigger"),
      autoPlayVideo: false
    });

});
</script>

<script>
  types = [
    'Todos',
    {%for te in type_events %}
      '{{te.tile}}',
    {% endfor%}
  ]

  function changeCategory(){
    type_is = $('#searchDropdownBox').val();
    console.log(type_is);
    $('#nav-search-in-content').text(types[$('#searchDropdownBox').val()]);
    $.ajax({
        url : "{% url 'events:getEvents' %}", // the endpoint
        type : "POST", // http method
        data : {
          csrfmiddlewaretoken: '{{ csrf_token }}',
          type_id : type_is,
        }, // data sent with the post request

        // handle a successful response
        success : function(json) {
            console.log(json); // log the returned json to the console
        },

        // handle a non-successful response
        error : function(xhr,errmsg,err) {
            console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
        }
    });
  }
</script>

  </body>
</html>
